==================================================
=== REPORTE DE ANÁLISIS DE CÓDIGO ===
Proyecto: auditoria-redhat
Ruta: /Users/andreiveis/UADE/2do cuatrimestre/07_Sistemas Operativos/TP_RedHat/auditoria-redhat
Generado el: Thu Jun 12 10:15:55 -03 2025
==================================================

--- INFORMACIÓN DEL REPOSITORIO GIT ---
Rama actual: main
Último commit: 2be919b - Version FINAL SIMPLIFICADA (andreiveisuade, 53 seconds ago)
---

--- ESTRUCTURA DEL DIRECTORIO ---
.
├── auditoria_fase1.sh
├── auditoria_fase2.sh
├── consigna.md
├── dar_permisos.sh
├── guia_de_ejecucion.md
└── scripts
    ├── fase1
    │   └── 01_escanear.sh
    └── fase2
        ├── 01_auditar_inicial_bd.sh
        ├── 02_configurar_firewall.sh
        └── 03_ajustar_permisos.sh

4 directories, 9 files
---



==================================================
=== FILE: /Users/andreiveis/UADE/2do cuatrimestre/07_Sistemas Operativos/TP_RedHat/auditoria-redhat/auditoria_fase1.sh 

#!/bin/bash

# Argumento: IP o hostname de la máquina a auditar
MAQUINA_TARGET="$1"

# Carpeta y archivo de log
LOG_DIR="./logs_auditoria"
mkdir -p "$LOG_DIR"
FECHA=$(date +"%Y%m%d_%H%M%S")
LOG="$LOG_DIR/auditoria_Fase1_$(hostname)_to_${MAQUINA_TARGET}_$FECHA.txt"

echo "[+] Iniciando auditoria_fase1.sh" | tee -a "$LOG"

# Ejecuta el script de escaneo y guarda salida en el log
bash ./scripts/fase1/01_escanear.sh "$MAQUINA_TARGET" | tee -a "$LOG"

echo "[+] Fin auditoria_fase1.sh" | tee -a "$LOG"

==================================================
=== FILE: /Users/andreiveis/UADE/2do cuatrimestre/07_Sistemas Operativos/TP_RedHat/auditoria-redhat/auditoria_fase2.sh 

#!/bin/bash

# Argumentos: usuario SSH y máquina destino
USER="$1"
TARGET="$2"

# Carpeta y archivo de log
LOG_DIR="./logs_auditoria"
mkdir -p "$LOG_DIR"
FECHA=$(date +"%Y%m%d_%H%M%S")
LOG="$LOG_DIR/fase2_$(hostname)_to_${TARGET}_$FECHA.log"

echo "[+] Iniciando auditoria_fase2.sh" | tee -a "$LOG"

# Ejecuta los scripts de endurecimiento en el servidor remoto
for s in 01_auditar_inicial_bd.sh 02_configurar_firewall.sh 03_ajustar_permisos.sh; do
  echo "[+] Ejecutando $s" | tee -a "$LOG"
  ssh -t "$USER@$TARGET" "sudo bash -s" < "./scripts/fase2/$s" | tee -a "$LOG"
done

echo "[+] Fin auditoria_fase2.sh" | tee -a "$LOG"

==================================================
=== FILE: /Users/andreiveis/UADE/2do cuatrimestre/07_Sistemas Operativos/TP_RedHat/auditoria-redhat/consigna.md 

# Unidad 6 - Trabajo Práctico

## “Fortalecimiento del Servidor de Producción: Auditoría y Endurecimiento”

### Planteamiento del Problema

Una pequeña empresa ha desplegado recientemente dos servidores basados en Red Hat: uno para aplicaciones web y otro para base de datos. Ante la inminente conexión con el entorno público, el responsable de sistemas recibe la orden de realizar una auditoría de seguridad básica y aplicar medidas de endurecimiento del sistema operativo.

### Se requiere:

1. Escanear el servidor de base de datos desde el servidor de aplicaciones para identificar puertos abiertos.
2. Limitar los servicios activos y aplicar reglas de firewall estrictas.
3. Revisar y ajustar permisos de archivos y directorios sensibles.

El objetivo es registrar todas las acciones en un archivo de log y automatizar parte del proceso con bash.

### Objetivos de Seguridad Cubiertos

- Mínima superficie de ataque (puertos/servicios).
- Integridad del sistema de archivos y configuraciones.

==================================================
=== FILE: /Users/andreiveis/UADE/2do cuatrimestre/07_Sistemas Operativos/TP_RedHat/auditoria-redhat/dar_permisos.sh 

#!/bin/bash

chmod +x auditoria_fase1.sh
chmod +x auditoria_fase2.sh
chmod +x scripts/fase1/*.sh
chmod +x scripts/fase2/*.sh

==================================================
=== FILE: /Users/andreiveis/UADE/2do cuatrimestre/07_Sistemas Operativos/TP_RedHat/auditoria-redhat/guia_de_ejecucion.md 

# Guía de Ejecución Unidad 6 - Auditoría y Endurecimiento

### Escenario

* **workstation**: Servidor de aplicaciones. Ejecuta el escaneo remoto.
* **utility**: Servidor de base de datos. Es el objetivo del escaneo y endurecimiento.

---

### Paso 1: Iniciar los servidores necesarios

Desde el panel de Red Hat levantar y hacer **Open Console** de:

- `workstation`
- `utility`

---

### Paso 2: Acceder a la consola de `workstation`

1. Clic en **Open Console** de `workstation`.
2. Iniciar sesión como `student` (o el usuario asignado).

---

### Paso 2.1: Verificaciones previas

1. Instalar `nmap` con:

```bash
sudo dnf install nmap
```

2. Verificar que `nmap` esta instalado con:

```bash
nmap --version
```

3. Hacer un `ip route` para verificar la ruta de red

### Paso 3 Verificar conectividad con `utility`

```bash
ping 5 utility
```

Debe responder con paquetes recibidos.


### Paso 4 Dar permisos de ejecución

```bash
chmod +x auditoria_fase1.sh
chmod +x auditoria_fase2.sh
chmod +x scripts/01_escanear.sh
chmod +x scripts/02_configurar_firewall.sh
chmod +x scripts/03_ajustar_permisos.sh
```

### Escaner la red con nmap

```bash
nmap -sn 172.25.250.0/24
nmap -sn 172.25.250.0/24 | grep "utility" | awk -F '[()]' '{print $2}'
```

El argumento -sn significa hacer un "ping" a la red, es decir que no hará escaneo de puertos, solo hará un escaneo de red para ver si hay dispositivos conectados.

La notación 172.25.250.0/24 define una red con máscara de 24 bits (255.255.255.0), lo cual significa que abarca las IPs desde 172.25.250.0 hasta 172.25.250.255.
Sin embargo, las direcciones .0 (red) y .255 (broadcast) no pueden asignarse a dispositivos. Por lo tanto, los hosts válidos están entre 172.25.250.1 y 172.25.250.254.


### Paso 5 Ejecutar Fase 1 - Escaneo remoto

Desde `workstation`, ejecutar:

```bash
bash ./auditoria_fase1.sh utility
```

Esto realizará el escaneo remoto y generará un reporte en `workstation` en la carpeta `reportes`.

### Paso 6 Verificar acceso SSH a `utility`

```bash
ssh student@utility
```

Debe responder con la contraseña del usuario `student`.

### Paso 7 Ejecutar Fase 2 - Endurecimiento

Desde `workstation`, ejecutar:

```bash
bash ./auditoria_fase2.sh utility
```

Esto realizará el endurecimiento remoto y generará un reporte en `workstation` en la carpeta `reportes`.



xrandr --output $(xrandr | grep " connected" | awk '{ print $1 }') --mode 1920x1080 ; gsettings set org.gnome.desktop.interface text-scaling-factor 1.5


git clone https://github.com/andreiveisuade/TPO-Sistemas_Operativos.git

nmap -sn 172.25.250.0/24

nmap -sn 172.25.250.0/24 | grep "utility" | awk -F '[()]' '{print $2}'

./auditoria_fase1.sh $(nmap -sn 172.25.250.0/24 | grep "utility" | awk -F '[()]' '{print $2}')

set relativenumber # Habilita el número relativo de las líneas en vim

==================================================
=== FILE: /Users/andreiveis/UADE/2do cuatrimestre/07_Sistemas Operativos/TP_RedHat/auditoria-redhat/scripts/fase1/01_escanear.sh 

#!/bin/bash

# Escanea puertos abiertos y versiones de servicios en una máquina remota
MAQUINA_TARGET="$1"

echo "[+] Escaneo rápido de puertos (-F)"
nmap -F "$MAQUINA_TARGET"

echo "[+] Detección de versiones de servicios (-sV)"
nmap -sV "$MAQUINA_TARGET"

==================================================
=== FILE: /Users/andreiveis/UADE/2do cuatrimestre/07_Sistemas Operativos/TP_RedHat/auditoria-redhat/scripts/fase2/01_auditar_inicial_bd.sh 

#!/bin/bash

# Muestra información básica sobre servicios y conexiones locales

echo "[+] Servicios habilitados al arranque"
systemctl list-unit-files --type=service --state=enabled

echo "[+] Servicios en ejecución"
systemctl list-units --type=service --state=running

echo "[+] Conexiones activas"
ss -tulnp | grep ESTAB

echo "[+] Puertos escuchando"
ss -tulnp | grep LISTEN

==================================================
=== FILE: /Users/andreiveis/UADE/2do cuatrimestre/07_Sistemas Operativos/TP_RedHat/auditoria-redhat/scripts/fase2/02_configurar_firewall.sh 

#!/bin/bash

# Activa el firewall y abre solo los servicios necesarios
systemctl enable --now firewalld
ZONA=$(firewall-cmd --get-default-zone)

firewall-cmd --permanent --zone="$ZONA" --add-service=ssh
firewall-cmd --permanent --zone="$ZONA" --add-port=3306/tcp
firewall-cmd --reload

==================================================
=== FILE: /Users/andreiveis/UADE/2do cuatrimestre/07_Sistemas Operativos/TP_RedHat/auditoria-redhat/scripts/fase2/03_ajustar_permisos.sh 

#!/bin/bash

# Ajusta permisos de archivos y directorios críticos
chmod 600 /etc/shadow /etc/gshadow /etc/my.cnf
chmod 644 /etc/passwd /etc/group
chmod 700 /root /var/lib/mysql
chmod 600 /etc/shadow /etc/gshadow /etc/my.cnf
chmod 644 /etc/passwd /etc/group
chmod 700 /root /var/lib/mysql

==================================================
=== FIN DEL REPORTE ===
==================================================
